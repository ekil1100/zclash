# 1.1 规划（与 1.0 并行推进）

> 生效时间：2026-02-12。与 1.0 试用期并行，优先低风险改动。

## 第一批任务（P7-2 泳道）

### [1.1] P7-2A 迁移规则扩展：proxy-groups 基础策略检测
- 目标：让 migrator 能检测 proxy-groups 中 select/url-test/fallback 的常见配置问题
- 范围：`tools/config-migrator/` + 回归
- DoD：
  - 新增至少 1 条 proxy-groups 规则（含 autofix 或 hint）
  - 回归脚本通过
  - 与现有 migrator gate chain 兼容
- 风险：低（新增规则，不修改现有规则逻辑）
- 回滚：删除新规则文件即可

### [1.1] P7-2B DNS 字段兼容补齐
- 目标：补齐 DNS 基础字段（enable/nameserver/fallback）从"部分支持"到"已支持"
- 范围：`src/` DNS 解析相关 + `docs/compat/`
- DoD：
  - 至少覆盖 enable/nameserver 两个字段的解析与验证
  - 迁移规则新增 DNS_FIELD_CHECK
  - 回归通过
- 风险：中（涉及核心解析路径）
- 回滚：feature flag 或条件编译隔离
- **约束：不破坏现有 DNS 行为，新增路径默认 off 直到验证通过**

### [1.1] P7-2C TUI 日志高亮最小实现
- 目标：日志面板支持按级别着色（error=红/warn=黄/info=默认）
- 范围：`src/` TUI 日志渲染 + 文档
- DoD：
  - error/warn/info 三级颜色区分
  - 不破坏现有 `--json` 日志输出
  - 可通过目测验收
- 风险：低（纯展示层）
- 回滚：去掉颜色渲染即还原

### [1.1] P7-2D 诊断命令增强：`zclash doctor` 输出结构化
- 目标：`zclash doctor` 输出环境/网络/配置健康度的结构化报告
- 范围：`src/doctor_cli.zig` + `docs/cli/spec.md`
- DoD：
  - 输出 `--json` 结构化诊断结果
  - 至少包含：版本/配置路径/网络连通性/端口占用 4 项
  - 与 `trial-healthcheck.sh` 诊断项对齐
- 风险：低（扩展已有 doctor 命令）
- 回滚：`--json` 新字段向后兼容，不影响旧输出

## 与 1.0 的并行/串行关系

```
[1.0 泳道]  稳定性基线(#5) ──→ 72h长稳(#7) ──→ 迁移边界(#8) ──→ 准入验收
                ↕ 不阻塞           ↕ 不阻塞          ↕ 不阻塞
[1.1 泳道]  P7-2A(迁移规则) ┐
            P7-2C(TUI日志)  ├── 全部并行，无串行依赖
            P7-2D(doctor)   ┘
            P7-2B(DNS) ──── 需额外验证不破坏 1.0 稳定性
```

- P7-2A/C/D：**完全并行**，不触及 1.0 稳定性路径
- P7-2B：**条件并行**，新功能默认 off，验证后才合入主线

## 冲突处理

若 1.1 任务导致 `run-all-regression.sh` 或 `run-beta-checklist.sh` 从 PASS 变 FAIL：
1. 立即停止该 1.1 任务
2. 回滚到上一个 PASS 的 commit
3. 在 TASKS 标注 blocked 原因
4. 优先恢复 1.0 稳定性
