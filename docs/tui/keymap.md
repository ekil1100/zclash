# TUI Keymap & Interaction Draft（P3-2 初稿）

## 1) 全局键位（跨 Tab 一致）

- `?`：打开/关闭快捷键帮助
- `/`：进入搜索/过滤输入
- `g`：快速跳转（Overview/Proxies/Connections/Logs/Diagnose）
- `r`：刷新当前视图
- `Tab` / `Shift+Tab`：焦点切换
- `j/k` 或 `↑/↓`：列表移动
- `Enter`：确认/进入详情
- `Esc`：返回上一级
- `q`：退出弹窗（主程序退出需二次确认）

---

## 2) Tab 专用交互草案

## 2.1 Proxies（代理组切换）
- `s`：在当前组执行“选择代理”
- `t`：触发当前组延迟测试
- `f`：按组名/节点名过滤
- `Enter`：查看组内节点详情

### 代理组切换交互流（可实现草案）
1. 用户在 Proxies 选中某个 group，按 `s` 进入选择态；
2. 列表高亮可选节点，`j/k` 移动，`Enter` 提交切换；
3. 提交后进入短暂 `switching` 状态（spinner + group/proxy）；
4. 成功：状态条显示 `Switched: <group> -> <proxy> @ <time>`；
5. 失败：弹出结构化错误（code/message/hint），并提供“重试/返回”操作。

### 失败提示规范
- 组不存在：`PROXY_GROUP_NOT_FOUND`
- 节点不存在：`PROXY_NOT_FOUND`
- 无可选组：`PROXY_SELECT_GROUP_MISSING`
- 其它失败：`PROXY_SELECT_FAILED`

反馈要求：
- 切换成功：底部状态条显示 `group/proxy` 与生效时间
- 切换失败：显示结构化错误 + 建议动作

### 延迟对比展示规则（可实现草案）
- 采样窗口：默认最近 **3 次**探测结果（滚动窗口）；
- 刷新方式：`t` 手动触发 + 可选后台周期刷新（默认关闭）；
- 排序口径：按 `p50 latency` 升序，若相同按最新成功时间降序；
- 空值处理：
  - 未测：显示 `--`，排序置底；
  - 超时/失败：显示 `timeout`，排序置底（高于未测）；
- 展示字段：`node`, `p50`, `last`, `samples(3)`；
- 可读性约束：仅在组内展示，不跨组混排。

## 2.2 Connections（连接筛选）
- `/`：按目标地址过滤
- `i`：按 inbound 类型过滤
- `o`：按 outbound 类型过滤
- `c`：清空筛选条件

反馈要求：
- 当前筛选条件常驻显示
- 空结果时显示“可执行建议”（例如清空筛选）

## 2.3 Logs（日志过滤）
- `l`：切换日志级别过滤（all/info/warn/error）
- `/`：关键字过滤
- `e`：仅错误日志
- `a`：恢复全部

反馈要求：
- 当前过滤器在标题栏可见
- 日志滚动定位稳定，不因刷新丢失上下文

## 2.4 Diagnose（重载反馈）
- `R`：触发配置重载
- `v`：触发配置校验
- `p`：触发端口检测

反馈要求：
- 每个动作给出结果：成功/失败/耗时
- 失败时必须给 `下一步动作`（修复建议）

---

## 3) 交互一致性约束

1. 同一按键在不同 Tab 不冲突；若局部重载必须明确提示。
2. 所有高风险动作（切换/重载）都需要可见反馈。
3. 搜索/过滤输入框的进入/退出行为在各 Tab 一致。

---

## 4) P3-2 实施顺序（建议）

1. 先做 Proxies：代理组切换 + 反馈（核心价值最高）
2. 再做 Connections：筛选体系（可观测效率提升）
3. 再做 Logs：过滤体系（排障效率提升）
4. 最后做 Diagnose：重载反馈闭环
